<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FakeStore</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .modal-custom {
            display: none;
            position: fixed;
            z-index: 1050;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content-custom {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
        }
    </style>
</head>

<body>

    <!-- header -->
    <nav class="navbar navbar-light bg-light justify-content-between px-4">
        <span class="navbar-brand">FakeStore</span>
        <button class="btn btn-outline-primary position-relative" onclick="showCart()">
            Cart <span class="badge bg-danger position-absolute top-0 start-100 translate-middle" id="cartCount">0</span>
        </button>
    </nav>

    <!-- category -->
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 bg-light" id="categorySidebar">
                <h5 class="mt-3">Categories</h5>
                <ul class="list-group" id="categoryList">
                    <li class="list-group-item active" onclick="handleAllProductsClick(this)">All Products</li>
                </ul>
            </div>
            <div class="col-md-10">
                <div class="row mt-3" id="productGrid"></div>
            </div>
        </div>
    </div>

    <!-- view details -->
    <div class="modal-custom" id="productModal">
        <div class="modal-content-custom">
            <h5 id="modalTitle"></h5>
            <div id="modalBody"></div>
            <button class="btn btn-secondary mt-3" onclick="closeProductModal()">Close</button>
        </div>
    </div>

    <!-- cart details -->
    <div class="modal-custom" id="cartModal">
        <div class="modal-content-custom">
            <h5>Your Cart</h5>
            <div id="cartBody" class="my-3"></div>
            <div class="d-flex justify-content-between align-items-center">
                <strong>Total: $<span id="cartTotal">0.00</span></strong>
                <button class="btn btn-success" onclick="checkout()">Checkout</button>
            </div>
            <button class="btn btn-secondary mt-3" onclick="closeCartModal()">Close</button>
        </div>
    </div>

    <script>
        const productGrid = document.getElementById("productGrid");
        const categoryList = document.getElementById("categoryList");
        const cartCount = document.getElementById("cartCount");
        const cartBody = document.getElementById("cartBody");
        const cartTotal = document.getElementById("cartTotal");
        let cart = [];

        // all products
        function loadAllProducts() {
            fetch("https://fakestoreapi.com/products")
                .then(res => res.json())
                .then(data => renderProducts(data));
        }

        //based on selected category
        function handleAllProductsClick(element) {
            setActiveCategory(element);
            loadAllProducts();
        }

        //only categories will load
        function loadCategories() {
            fetch("https://fakestoreapi.com/products/categories")
                .then(res => res.json())
                .then(categories => {
                    categories.forEach(category => {
                        const li = document.createElement("li");
                        li.className = "list-group-item";
                        li.innerText = category;
                        li.onclick = function() {
                            setActiveCategory(this);
                            loadProductsByCategory(category);
                        };
                        categoryList.appendChild(li);
                    });
                });
        }


        // activating  selecting category 
        function setActiveCategory(selectedElement) {
            const items = document.querySelectorAll("#categoryList li");
            items.forEach(item => item.classList.remove("active"));
            selectedElement.classList.add("active");
        }

        function loadProductsByCategory(category) {
            fetch(`https://fakestoreapi.com/products/category/${category}`)
                .then(res => res.json())
                .then(data => renderProducts(data));
        }

        function renderProducts(products) {
            productGrid.innerHTML = "";
            products.forEach(product => {
                const col = document.createElement("div");
                col.className = "col-md-4 mb-4";

                const card = document.createElement("div");
                card.className = "card h-100 shadow-sm";

                const img = document.createElement("img");
                img.src = product.image;
                img.className = "card-img-top p-4";
                img.style.height = "250px";
                img.style.objectFit = "contain";

                const body = document.createElement("div");
                body.className = "card-body";

                const title = document.createElement("h5");
                title.className = "card-title";
                title.innerText = product.title.length > 45 ? product.title.slice(0, 45) + "..." : product.title;

                const category = document.createElement("p");
                category.className = "text-muted mb-1";
                category.innerText = product.category;

                const price = document.createElement("p");
                price.className = "text-success fw-bold";
                price.innerText = `$${product.price}`;

                const viewBtn = document.createElement("button");
                viewBtn.className = "btn btn-primary btn-sm me-2";
                viewBtn.innerText = "View Details";
                viewBtn.onclick = () => showProductDetails(product);

                const cartBtn = document.createElement("button");
                cartBtn.className = "btn btn-success btn-sm";
                cartBtn.innerText = "Add to Cart";
                cartBtn.onclick = () => addToCart(product);

                const btnGroup = document.createElement("div");
                btnGroup.className = "d-flex justify-content-between";
                btnGroup.append(viewBtn, cartBtn);

                body.append(title, category, price, btnGroup);
                card.append(img, body);
                col.appendChild(card);
                productGrid.appendChild(col);
            });
        }


        //view details
        function showProductDetails(product) {
            document.getElementById("modalTitle").innerText = product.title;
            document.getElementById("modalBody").innerHTML = `
                <img src="${product.image}" class="img-fluid mb-3" style="max-height: 300px;">
                <p><strong>Category:</strong> ${product.category}</p>
                <p><strong>Description:</strong> ${product.description}</p>
                <p><strong>Price:</strong> $${product.price}</p>
                <button class="btn btn-success" onclick='addToCartFromModal(${JSON.stringify(product).replace(/'/g, "\\'")})'>Add to Cart</button>
            `;
            document.getElementById("productModal").style.display = "block";
        }

        function addToCart(product) {
            cart.push(product);
            cartCount.innerText = cart.length;
        }

        function addToCartFromModal(product) {
            addToCart(product);
            closeProductModal();
        }

        function showCart() {
            const cartModal = document.getElementById("cartModal");
            cartBody.innerHTML = "";
            let total = 0;

            if (cart.length === 0) {
                cartBody.innerHTML = "<p>Your cart is empty.</p>";
                cartTotal.innerText = "0.00";
            } else {
                cart.forEach(item => {
                    const row = document.createElement("div");
                    row.className = "d-flex mb-2 border-bottom pb-2";
                    row.innerHTML = `
                        <img src="${item.image}" style="height: 50px; width: 50px; object-fit: contain; margin-right: 10px;">
                        <div>
                            <p class="mb-1 fw-bold">${item.title.slice(0, 40)}...</p>
                            <p class="text-success">$${item.price}</p>
                        </div>
                    `;
                    cartBody.appendChild(row);
                    total += item.price;
                });
                cartTotal.innerText = total.toFixed(2);
            }

            cartModal.style.display = "block";
        }

        function checkout() {
            alert("Checkout complete!");
            cart = [];
            cartCount.innerText = "0";
            closeCartModal();
        }

        function closeProductModal() {
            document.getElementById("productModal").style.display = "none";
        }

        function closeCartModal() {
            document.getElementById("cartModal").style.display = "none";
        }

        loadAllProducts();
        loadCategories();
    </script>
</body>

</html>